from kivy.uix.screenmanager import Screen
from kivy.uix.floatlayout import FloatLayout
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.image import Image
from kivy.uix.textinput import TextInput
from kivy.uix.button import Button
from services.api import api

class LoginScreen(Screen):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        root = FloatLayout()
        card = BoxLayout(orientation="vertical", spacing=12, size_hint=(None, None), size=(320, 480),
                         pos_hint={"center_x": 0.5, "center_y": 0.5})
        card.add_widget(Image(source="assets/logo.png", size_hint=(None, None), size=(160, 160)))
        self.email = TextInput(hint_text="EMAIL ADDRESS", size_hint=(None, None), size=(280, 40), multiline=False,
                               background_normal="", background_color=(1,1,1,1))
        self.password = TextInput(hint_text="PASSWORD", password=True, size_hint=(None, None), size=(280, 40), multiline=False,
                                  background_normal="", background_color=(1,1,1,1))
        card.add_widget(self.email)
        card.add_widget(self.password)
        login_btn = Button(text="Log in", size_hint=(None, None), size=(220, 48), background_normal="", background_color=(0.07,0.1,0.5,1), color=(1,1,1,1))
        login_btn.bind(on_press=self.login)
        signup_btn = Button(text="ðŸ‘¤ Sign Up", size_hint=(None, None), size=(220,48), background_normal="", background_color=(0.6,0.5,1,1), color=(1,1,1,1))
        signup_btn.bind(on_press=self.go_register)
        card.add_widget(login_btn)
        card.add_widget(signup_btn)
        root.add_widget(card)
        self.add_widget(root)

    def login(self, instance):
        email = self.email.text.strip()
        password = self.password.text.strip()
        if not email or not password:
            print("Please enter Email & Password.")
            return
        resp = api.login(email, password)
        if resp.status_code == 200:
            print("Login success")
            self.manager.current = "tasks"
        else:
            print("Login failed:", resp.text)

    def go_register(self, instance):
        self.manager.current = "register"
